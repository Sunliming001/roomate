<view class="container" style="padding-top: {{paddingTop}}px">
  <view class="page-title">å‘å¸ƒæ‰¾èˆå‹</view>
  
  <!-- åŸºç¡€ä¿¡æ¯ -->
  <view class="card">
    <view class="row click" bindtap="chooseLocation">
      <text class="lbl">å°åŒºåœ°ç‚¹</text>
      <view class="val-box">
         <text class="val-txt {{formData.community?'':'ph'}}">{{formData.community || 'ç‚¹å‡»é€‰æ‹©'}}</text>
         <text class="arrow">></text>
      </view>
    </view>
    <view class="row">
      <text class="lbl">æˆ·å‹</text>
      <view class="flex">
        <input class="s-in" type="number" placeholder="3" bindinput="onRoomCountInput" value="{{formData.layout.room}}"/> å®¤
        <input class="s-in" type="number" placeholder="1" bindinput="bindInput" data-path="formData.layout.hall" value="{{formData.layout.hall}}"/> å…
        <input class="s-in" type="number" placeholder="1" bindinput="bindInput" data-path="formData.layout.toilet" value="{{formData.layout.toilet}}"/> å«
      </view>
    </view>
    <view class="row">
      <text class="lbl">æ€»ç§Ÿé‡‘</text>
      <input class="val-in" type="digit" placeholder="0" bindinput="bindInput" data-path="formData.totalPrice" value="{{formData.totalPrice}}"/>
    </view>
    
    <!-- æ–°å¢ï¼šå® ç‰©è¦æ±‚ -->
    <view class="row" style="height:auto; padding: 20rpx 0; display:block;">
      <view class="lbl" style="margin-bottom:16rpx;">å® ç‰©è¦æ±‚ (å¯å¤šé€‰)</view>
      <view class="pet-group">
         <block wx:for="{{petOpts}}" wx:key="key">
            <!-- æ£€æŸ¥æ•°ç»„ä¸­æ˜¯å¦åŒ…å«è¯¥keyï¼Œé«˜äº®æ˜¾ç¤º -->
            <view 
              class="pet-tag {{utils.includes(formData.pets, item.key) ? 'active' : ''}}" 
              bindtap="togglePet" 
              data-key="{{item.key}}"
            >{{item.name}}</view>
         </block>
      </view>
    </view>
  </view>

  <!-- æˆ¿é—´åˆ—è¡¨ -->
  <block wx:for="{{formData.rooms}}" wx:key="index">
    <view class="card room-card {{item.status==1?'occ':''}}">
      <view class="r-head">
        <text class="badge">æˆ¿é—´ {{index+1}}</text>
        <view class="sw-box">
          <text>{{item.status==1?'å·²å…¥ä½':'æ‹›å‹Ÿä¸­'}}</text>
          <switch scale="0.7" color="#FF2442" checked="{{item.status==1}}" bindchange="toggleRoomStatus" data-idx="{{index}}"/>
        </view>
      </view>

      <view class="r-body">
        <view class="flex mb">
          <input class="m-in" placeholder="åç§°(ä¸»å§)" value="{{item.name}}" bindinput="updateRoomField" data-idx="{{index}}" data-field="name"/>
          <input class="m-in" placeholder="é¢ç§¯ã¡" type="digit" value="{{item.area}}" bindinput="updateRoomField" data-idx="{{index}}" data-field="area"/>
          <input class="m-in red" type="digit" placeholder="ç§Ÿé‡‘" value="{{item.price}}" bindinput="updateRoomField" data-idx="{{index}}" data-field="price"/>
        </view>
        <view class="flex mb">
           <view class="ensuite" bindtap="toggleEnsuite">
             <text>ç‹¬ç«‹å«ç”Ÿé—´</text>
             <switch scale="0.6" checked="{{item.hasEnsuite}}" bindchange="toggleEnsuite" data-idx="{{index}}"/>
           </view>
        </view>

        <!-- å·²å…¥ä½çŠ¶æ€ -->
        <view wx:if="{{item.status==1}}" class="sec-box">
           <view class="p-row">
             <text>æ˜¯å¦æœ¬äººå…¥ä½</text>
             <picker range="{{['æ˜¯','å¦']}}" value="{{item.isMeIndex}}" bindchange="onIsMeChange" data-idx="{{index}}">
               <view class="pk-val">{{['æ˜¯','å¦'][item.isMeIndex]}} â–¾</view>
             </picker>
           </view>
           
           <view wx:if="{{item.isMeIndex==1}}" class="grid-form">
             <picker range="{{genderOptions}}" value="{{item.occupant.genderIndex}}" bindchange="onOccGenderChange" data-idx="{{index}}">
                <view class="grid-item">
                   <text class="g-lbl">æ€§åˆ«</text>
                   <text class="g-val">{{genderOptions[item.occupant.genderIndex]}} â–¾</text>
                </view>
             </picker>
             <picker range="{{ageOptions}}" value="{{item.occupant.ageIndex}}" bindchange="onOccAgeChange" data-idx="{{index}}">
                <view class="grid-item">
                   <text class="g-lbl">å¹´é¾„</text>
                   <text class="g-val">{{ageOptions[item.occupant.ageIndex]}} â–¾</text>
                </view>
             </picker>
             <view class="grid-item input-item">
                <text class="g-lbl">èŒä¸š</text>
                <input class="g-in" placeholder="è¯·è¾“å…¥" value="{{item.occupant.job}}" bindinput="updateRoomField" data-idx="{{index}}" data-field="occupant.job"/>
             </view>
           </view>
        </view>

        <!-- æ‹›å‹Ÿä¸­çŠ¶æ€ -->
        <view wx:if="{{item.status==0}}" class="sec-box">
           <view class="flex">
              <text>æœŸæœ›æ€§åˆ«</text>
              <picker range="{{['ä¸é™','ç”·','å¥³']}}" value="{{item.expectGender}}" bindchange="onExpectGenderChange" data-idx="{{index}}">
                 <view class="pk-val">{{['ä¸é™','ç”·','å¥³'][item.expectGender]}} â–¾</view>
              </picker>
           </view>
        </view>

        <view class="photo-upload" bindtap="uploadRoomPhoto" data-idx="{{index}}">
           <image wx:if="{{item.photos[0]}}" src="{{item.photos[0]}}" mode="aspectFill" class="pv-img"></image>
           <view wx:else class="tip">ğŸ“· æˆ¿é—´ç…§ç‰‡(3:4)</view>
        </view>
      </view>
    </view>
  </block>

  <view style="height:200rpx"></view>
  <button class="pub-btn" bindtap="submit">å‘å¸ƒæ‰¾èˆå‹</button>
</view>

<!-- WXS å·¥å…·ç±»ï¼šç”¨äºåˆ¤æ–­æ•°ç»„åŒ…å« -->
<wxs module="utils">
module.exports.includes = function(arr, item) {
  return arr && arr.indexOf(item) > -1;
}
</wxs>