<view class="container">
  <!-- 1. 头部 -->
  <view class="custom-header" style="padding-top:{{statusBarHeight}}px; height:44px;">
    <view class="header-row">
      <view class="back-btn" bindtap="goBack">←</view>
      <view class="header-title">{{title}}</view>
    </view>
  </view>

  <!-- 2. 消息列表 -->
  <!-- 修复：padding-top 设为 状态栏+44+20(间距)，防止遮挡 -->
  <scroll-view 
    scroll-y 
    class="chat-scroll" 
    scroll-into-view="{{scrollId}}"
    style="padding-top: {{statusBarHeight + 44 + 20}}px; padding-bottom: calc(120rpx + env(safe-area-inset-bottom));"
  >
    <block wx:for="{{messages}}" wx:key="_id">
      <view class="msg-container {{item.isMe ? 'align-right' : 'align-left'}}" id="msg-{{index}}">
        
        <view class="msg-row {{item.isMe ? 'my-msg' : 'other-msg'}}">
          <image class="avatar" src="{{item.avatar}}"></image>
          <view class="bubble">
            <text>{{item.content}}</text>
          </view>
        </view>

        <view class="status-row" wx:if="{{item.isMe}}">
           <text class="read-txt {{item.readStatusText=='未读'?'un':''}}">{{item.readStatusText}}</text>
        </view>

      </view>
    </block>
    <view id="bottom-pad" style="height: 20rpx;"></view>
  </scroll-view>

  <!-- 3. 输入框 -->
  <view class="input-area">
    <input class="msg-input" value="{{inputVal}}" bindinput="onInput" placeholder="发送消息..." confirm-type="send" bindconfirm="send" adjust-position="{{true}}"/>
    <button class="send-btn" bindtap="send">发送</button>
  </view>
</view>