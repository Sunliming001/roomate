<view class="container">
  <!-- å¯¼èˆªè¿”å› -->
  <view class="back-btn" style="top:{{statusBarHeight+8}}px" bindtap="goBack">â†</view>

  <!-- é¡¶éƒ¨ç›¸å†Œ -->
  <swiper class="swiper" indicator-dots circular>
    <block wx:for="{{gallery}}" wx:key="index">
      <swiper-item bindtap="previewImg" data-url="{{item.url}}">
        <image src="{{item.url}}" mode="aspectFill" class="slide-img"></image>
        <view class="slide-label">{{item.name}}</view>
      </swiper-item>
    </block>
  </swiper>

  <view class="content">
    <!-- æ ‡é¢˜å¡ç‰‡ -->
    <view class="card title-card">
      <view class="h1">{{info.community}} {{info.layout.room}}å®¤</view>
      <view class="price">Â¥{{info.minPrice}}<text class="sub">èµ·/æœˆ</text></view>
    </view>

    <!-- æˆ¿é—´åˆ†é…æƒ…å†µ -->
    <view class="card">
       <view class="st">æˆ¿é—´åˆ†é…æƒ…å†µ</view>
       <block wx:for="{{info.rooms}}" wx:key="index">
          <view class="room-row">
             <view class="rr-l">
                <view class="rname">{{item.name}}</view>
                <view class="rtags">
                   <text class="tg" wx:if="{{item.hasEnsuite}}">ç‹¬å«</text>
                   <text class="tg">{{item.area}}ã¡</text>
                </view>
             </view>
             <view class="rr-r">
                <block wx:if="{{item.status==1}}">
                   <view class="occ-badge">å·²å…¥ä½</view>
                   <view class="occ-info">
                      <text>{{['ç”·','å¥³'][item.occupantDisplay.gender]}}</text>
                      <text>Â·{{item.occupantDisplay.age}}</text>
                      <text>Â·{{item.occupantDisplay.job}}</text>
                   </view>
                </block>
                <block wx:else>
                   <view class="vac-price">Â¥{{item.price}}</view>
                   <view class="exp-txt">æœŸæœ›: {{['ä¸é™','ç”·','å¥³'][item.expectGender]}}</view>
                </block>
             </view>
          </view>
       </block>
    </view>

    <!-- æˆ¿ä¸»ä¿¡æ¯ -->
    <view class="card pub-card">
       <image class="p-avt" src="{{info.publisher.avatarUrl}}"></image>
       <view class="p-txt">
          <view class="pn">{{info.publisher.nickName}}</view>
          <view class="pt">æˆ¿ä¸»</view>
       </view>
    </view>
  </view>

  <view style="height: 180rpx;"></view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="footer-bar safe-bottom">
    <view class="icon-btn" bindtap="handleFav">
      <text class="icon" style="color: {{isFav ? '#FFD700' : '#666'}}">{{isFav ? 'â˜…' : 'â˜†'}}</text>
      <text class="txt">{{isFav ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
    </view>
    
    <view class="icon-btn" bindtap="openShareModal">
      <text class="icon">â†—</text>
      <text class="txt">åˆ†äº«</text>
    </view>
    
    <view class="chat-btn" bindtap="handleChat">
      <text>ğŸ’¬ èŠä¸€èŠ</text>
    </view>

    <button class="join-btn" bindtap="openJoinModal" disabled="{{info.status==='completed'}}">
      {{info.status==='completed' ? 'å·²æ»¡å‘˜' : 'æˆ‘æƒ³åŠ å…¥'}}
    </button>
  </view>

  <!-- åŠ å…¥é€‰æ‹©å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showJoinModal}}" bindtap="closeJoinModal">
    <!-- catchtap="preventBubble" é˜»æ­¢ç‚¹å‡»å†…å®¹å…³é—­å¼¹çª— -->
    <view class="modal-content" catchtap="preventBubble">
      <view class="m-title">é€‰æ‹©è¦åŠ å…¥çš„æˆ¿é—´</view>
      <view class="m-list">
        <block wx:for="{{info.rooms}}" wx:key="index">
          <view wx:if="{{item.status==0}}" class="m-item" bindtap="confirmJoin" data-idx="{{index}}" data-name="{{item.name}}">
            <view class="m-name">{{item.name}}</view>
            <view class="m-price">Â¥{{item.price}}</view>
            <view class="m-btn">ç”³è¯·åŠ å…¥</view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«é€‰æ‹©å¼¹çª— -->
  <view class="share-mask" wx:if="{{showShareModal}}" bindtap="closeShareModal">
    <view class="share-panel" catchtap="preventBubble">
      <view class="share-title">åˆ†äº«åˆ°</view>
      <view class="share-grid">
        <button class="share-item" open-type="share">
          <view class="s-icon wx">ğŸ’¬</view>
          <text>å¾®ä¿¡å¥½å‹</text>
        </button>
        <view class="share-item" bindtap="handleShareTo" data-app="æœ‹å‹åœˆ">
          <view class="s-icon pyq">â—</view>
          <text>æœ‹å‹åœˆ</text>
        </view>
        <view class="share-item" bindtap="handleShareTo" data-app="QQ">
          <view class="s-icon qq">ğŸ§</view>
          <text>QQ</text>
        </view>
        <view class="share-item" bindtap="handleShareTo" data-app="å°çº¢ä¹¦">
          <view class="s-icon xhs">ğŸ“•</view>
          <text>å°çº¢ä¹¦</text>
        </view>
        <view class="share-item" bindtap="handleShareTo" data-app="å¾®åš">
          <view class="s-icon wb">ğŸ”´</view>
          <text>å¾®åš</text>
        </view>
        <view class="share-item" bindtap="handleCopyLink">
          <view class="s-icon link">ğŸ”—</view>
          <text>å¤åˆ¶é“¾æ¥</text>
        </view>
      </view>
      <view class="share-cancel" bindtap="closeShareModal">å–æ¶ˆ</view>
    </view>
  </view>

</view>