<view class="container">
  <view class="back-btn" style="top:{{statusBarHeight+8}}px" bindtap="goBack">â†</view>

  <swiper class="swiper" indicator-dots circular>
    <block wx:for="{{gallery}}" wx:key="index">
      <swiper-item bindtap="previewImg" data-url="{{item.url}}">
        <image src="{{item.url}}" mode="aspectFill" class="slide-img"></image>
        <view class="slide-label">{{item.name}}</view>
      </swiper-item>
    </block>
  </swiper>

  <view class="content">
    <view class="card title-card">
      <view class="h1">{{info.community}} {{info.layout.room}}å®¤</view>
      <view class="price">Â¥{{info.minPrice}}<text class="sub">èµ·/æœˆ</text></view>
    </view>

    <view class="card">
       <view class="st">æˆ¿é—´åˆ†é…æƒ…å†µ</view>
       <block wx:for="{{info.rooms}}" wx:key="index">
          <view class="room-row">
             <view class="rr-l">
                <view class="rname">{{item.name}}</view>
                <view class="rtags">
                   <text class="tg" wx:if="{{item.hasEnsuite}}">ç‹¬å«</text>
                   <text class="tg">{{item.area}}ã¡</text>
                </view>
             </view>
             <view class="rr-r">
                <block wx:if="{{item.status==1}}">
                   <view class="occ-badge">å·²å…¥ä½</view>
                   <view class="occ-info">
                      <text>{{['ç”·','å¥³'][item.occupantDisplay.gender]}}</text>
                      <text>Â·{{item.occupantDisplay.age}}</text>
                      <text>Â·{{item.occupantDisplay.job}}</text>
                   </view>
                </block>
                <block wx:else>
                   <view class="vac-price">Â¥{{item.price}}</view>
                   <view class="exp-txt">æœŸæœ›: {{['ä¸é™','ç”·','å¥³'][item.expectGender]}}</view>
                </block>
             </view>
          </view>
       </block>
    </view>

    <view class="card pub-card">
       <image class="p-avt" src="{{info.publisher.avatarUrl}}"></image>
       <view class="p-txt">
          <view class="pn">{{info.publisher.nickName}}</view>
          <view class="pt">æˆ¿ä¸»</view>
       </view>
    </view>
  </view>

  <view style="height: 180rpx;"></view>

  <view class="footer-bar safe-bottom">
    <view class="icon-btn" bindtap="handleFav">
      <!-- å®å¿ƒæ˜Ÿä»£è¡¨å·²æ”¶è— -->
      <text class="icon" style="color: {{isFav ? '#FFD700' : '#666'}}">{{isFav ? 'â˜…' : 'â˜†'}}</text>
      <text class="txt">{{isFav ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
    </view>
    
    <view class="chat-btn" bindtap="handleChat">
      <text>ğŸ’¬ èŠä¸€èŠ</text>
    </view>

    <button class="join-btn" bindtap="openJoinModal" disabled="{{info.status==='completed'}}">
      {{info.status==='completed' ? 'å·²æ»¡å‘˜' : 'æˆ‘æƒ³åŠ å…¥'}}
    </button>
  </view>

  <view class="modal-mask" wx:if="{{showJoinModal}}" bindtap="closeJoinModal">
    <view class="modal-content" catchtap="true">
      <view class="m-title">é€‰æ‹©è¦åŠ å…¥çš„æˆ¿é—´</view>
      <view class="m-list">
        <block wx:for="{{info.rooms}}" wx:key="index">
          <view wx:if="{{item.status==0}}" class="m-item" bindtap="confirmJoin" data-idx="{{index}}" data-name="{{item.name}}">
            <view class="m-name">{{item.name}}</view>
            <view class="m-price">Â¥{{item.price}}</view>
            <view class="m-btn">ç”³è¯·åŠ å…¥</view>
          </view>
        </block>
      </view>
    </view>
  </view>
</view>