<view class="container" style="padding-top: {{paddingTop}}px">
  <view class="tabs">
    <view class="tab {{curTab==0?'active':''}}" bindtap="switchTab" data-idx="0">
      èŠå¤©
      <view class="dot" wx:if="{{hasUnreadChat}}"></view>
    </view>
    <view class="tab {{curTab==1?'active':''}}" bindtap="switchTab" data-idx="1">
      é€šçŸ¥ 
      <view class="dot" wx:if="{{hasUnreadNotif}}"></view>
    </view>
  </view>

  <!-- 0: èŠå¤©åˆ—è¡¨ -->
  <view wx:if="{{curTab==0}}" class="list-box">
    <block wx:for="{{chatList}}" wx:key="_id">
      <view class="chat-item" bindtap="goChat" data-id="{{item._id}}" data-name="{{item.roomName}}">
        <view class="avatar-box">
           <view class="group-avatar">
             <image wx:for="{{item.memberAvatars}}" wx:for-item="url" wx:key="*this" src="{{url}}" class="g-avt"></image>
           </view>
           <view class="red-badge" wx:if="{{item.hasUnread}}"></view>
        </view>
        <view class="content">
          <view class="top">
            <text class="name">{{item.roomName}}</text>
            <text class="time">{{item.timeStr}}</text>
          </view>
          <view class="btm">
            <text class="last-msg">{{item.lastMessage}}</text>
          </view>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{chatList.length==0}}" class="empty-container">
      <view class="empty-visual chat-bg">
        <text class="empty-emoji">ğŸ’­</text>
        <view class="bubble-dec"></view>
      </view>
      <view class="empty-title">è¿˜æ²¡æœ‰æ¶ˆæ¯å‘¢</view>
      <view class="empty-desc">å¿«å»é¦–é¡µæ‰¾ä¸ªå¿ƒä»ªçš„å®¤å‹èŠèŠå§~</view>
      <view class="empty-btn" bindtap="goHome">å»é€›é€›</view>
    </view>
  </view>

  <!-- 1: é€šçŸ¥åˆ—è¡¨ -->
  <view wx:if="{{curTab==1}}" class="list-box">
    <block wx:for="{{notifList}}" wx:key="_id">
      <view class="notif-card simple" wx:if="{{item.type !== 'join_req'}}" bindtap="readNotification" data-id="{{item._id}}" data-read="{{item.isRead}}">
        <view class="n-icon">
           {{item.icon}}
           <view class="mini-dot" wx:if="{{!item.isRead}}"></view>
        </view>
        <view class="n-info">
           <view class="n-title">{{item.title}}</view>
           <view class="n-desc">{{item.content}}</view>
           <view class="n-time">{{item.timeStr}}</view>
        </view>
      </view>

      <view class="notif-card req" wx:if="{{item.type === 'join_req'}}">
        <view class="req-head">
           <view class="rh-box">
             <text class="rh-t">ç”³è¯·åŠ å…¥</text>
             <view class="mini-dot" wx:if="{{!item.isRead}}"></view>
           </view>
           <text class="rh-time">{{item.timeStr}}</text>
        </view>
        <view class="req-user" bindtap="viewApplicant" data-user="{{item.sender}}">
           <image class="u-avt" src="{{item.sender.avatarUrl}}"></image>
           <view class="u-info">
              <view class="u-n">{{item.sender.nickName}}</view>
              <view class="u-d">{{['ç”·','å¥³'][item.sender.gender-1]}} Â· {{item.sender.job}}</view>
           </view>
           <text class="view-dtl">æŸ¥çœ‹è¯¦æƒ… ></text>
        </view>
        <view class="req-actions" wx:if="{{item.status=='pending'}}">
           <button class="btn reject" size="mini" bindtap="handleReq" data-id="{{item._id}}" data-act="reject" data-idx="{{index}}">æ‹’ç»</button>
           <button class="btn agree" size="mini" bindtap="handleReq" data-id="{{item._id}}" data-act="agree" data-idx="{{index}}">åŒæ„</button>
        </view>
        <view class="req-res" wx:else>
           {{item.status=='accepted' ? 'å·²åŒæ„' : 'å·²æ‹’ç»'}}
        </view>
      </view>
    </block>

    <!-- é€šçŸ¥ç©ºçŠ¶æ€ -->
    <view wx:if="{{notifList.length==0}}" class="empty-container">
      <view class="empty-visual notif-bg">
        <text class="empty-emoji">ğŸ”•</text>
      </view>
      <view class="empty-title">è¿™é‡Œé™æ‚„æ‚„çš„</view>
      <view class="empty-desc">æš‚æ—¶æ²¡æœ‰æ”¶åˆ°æ–°çš„é€šçŸ¥å“¦</view>
    </view>
  </view>
</view>